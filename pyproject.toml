[tool.uv.workspace]
members = ["src/*"]

[dependency-groups]
dev = [
  "ruff>=0.14.0",
  "numpy>=1.26.0",
  "pypdfium2>=4.30.0",
  "faiss-cpu>=1.8.0",
  "pytest>=8.3.0",
  "pytest-asyncio>=0.24.0",
  "pytest-mock>=3.14.0",
  "pytest-cov>=6.0.0",
  "pre-commit>=4.0.0",
  "pip>=24.0.0",
  "setuptools>=70.0.0",
  "ty>=0.0.0a5",
  "lxml-stubs>=0.5.1",
  "liccheck>=0.9.2",
  "twine>=6.0.0",
  "nox>=2024.10.9",
  "testcontainers>=4.9.0",
]

[tool.ruff]
line-length = 100
target-version = "py312"

[tool.ruff.lint]
select = ["E4", "E7", "E9", "F", "E501"]
ignore = ["E731", "E203", "E741"]

[tool.ruff.lint.per-file-ignores]
"*.ipynb" = ["E501"]

[tool.pytest.ini_options]
testpaths = ["tests"]
python_files = ["test_*.py"]
python_classes = ["Test*"]
python_functions = ["test_*"]
markers = [
  "no_hub_telemetry_mock: Skip hub telemetry mocking",
  "integration: Integration tests requiring Docker",
]
addopts = [
  "-v",
  "--strict-markers",
  "--tb=short",
  "-m", "not integration",
]

[tool.ty]

[tool.ty.rules]
invalid-method-override = "ignore"
missing-argument = "ignore"
unknown-argument = "ignore"
unresolved-attribute = "ignore"
unresolved-import = "warn"
invalid-argument-type = "warn"
invalid-return-type = "warn"
invalid-assignment = "warn"
invalid-type-form = "warn"
parameter-already-assigned = "warn"
invalid-context-manager = "warn"
possibly-missing-attribute = "warn"
invalid-parameter-default = "ignore"

[tool.ty.src]
include = ["src/guardrails/guardrails"]
exclude = [
  "src/guardrails/guardrails/utils/openai_utils/v1.py",
  "src/guardrails/guardrails/utils/sql_utils.py",
  "src/guardrails/guardrails/schema/**",
  "src/guardrails/guardrails/telemetry/**",
  "src/guardrails/guardrails/utils/docs_utils.py",
  "src/guardrails/guardrails/utils/misc.py",
  "src/guardrails/guardrails/vectordb/**",
  "src/guardrails/guardrails/guard.py",
  "src/guardrails/guardrails/llm_providers.py",
  "src/guardrails/guardrails/run/**",
  "src/guardrails/guardrails/integrations/**",
  "src/guardrails/guardrails/cli/**",
  "src/guardrails/guardrails/embedding.py",
  "src/guardrails/guardrails/formatters/**",
  "src/guardrails/guardrails/classes/validation/**",
  "src/guardrails/guardrails/classes/validation_outcome.py",
  "src/guardrails/guardrails/async_guard.py",
  "src/guardrails/guardrails/call_tracing/**",
]

[[tool.ty.overrides]]
include = ["src/guardrails/guardrails/vectordb/faiss.py"]

[tool.ty.overrides.rules]
unresolved-import = "ignore"
invalid-method-override = "ignore"

[[tool.ty.overrides]]
include = [
  "src/guardrails/guardrails/validator_service/async_validator_service.py",
  "src/guardrails/guardrails/validator_service/sequential_validator_service.py",
]

[tool.ty.overrides.rules]
invalid-method-override = "ignore"

[[tool.ty.overrides]]
include = ["src/guardrails/guardrails/validator_base.py"]

[tool.ty.overrides.rules]
invalid-argument-type = "ignore"
invalid-assignment = "ignore"
invalid-return-type = "ignore"
no-matching-overload = "ignore"
possibly-missing-attribute = "ignore"
unresolved-attribute = "ignore"

[[tool.ty.overrides]]
include = ["src/guardrails/guardrails/utils/openai_utils/v1.py"]

[tool.ty.overrides.rules]
unresolved-attribute = "ignore"

[[tool.ty.overrides]]
include = ["src/guardrails/guardrails/utils/sql_utils.py"]

[tool.ty.overrides.rules]
unresolved-import = "ignore"

[tool.coverage.run]
source = ["src/guardrails/guardrails"]
omit = [
  "*/tests/*",
  "*/test_*.py",
  "*/__pycache__/*",
]

[tool.coverage.report]
precision = 2
show_missing = true
skip_covered = false

[tool.liccheck]
authorized_licenses = [
  "3-clause bsd",
  "bsd",
  "bsd3",
  "bsd-3-clause",
  "new bsd",
  "bsd license",
  "new bsd license",
  "simplified bsd",
  "academic free license (afl)",
  "apache",
  "apache 2.0",
  "apache-2.0",
  "apache license 2.0",
  "apache software",
  "apache software license",
  "apache-2.0 and cnri-python",
  "gnu lgpl",
  "lgpl with exceptions or zpl",
  "gnu library or lesser general public license (lgpl)",
  "isc",
  "isc license",
  "isc license (iscl)",
  "mit",
  "mit license",
  "mozilla public license 2.0 (mpl 2.0)",
  "the unlicense (unlicense)",
  "python software foundation",
  "python software foundation license",
  "psf-2.0",
  "zpl 2.1",
  "mit and python-2.0",
  "apache-2.0 and mit",
]
unauthorized_licenses = [
  "gpl v3",
]
level = "Paranoid"

[tool.liccheck.authorized_packages]
aiocache = ">=0.12.3"
aiohappyeyeballs = ">=2.4.3"
docutils = "*"
guardrails-api-client = "*"
guardrails-api = "*"
pondpond = ">=1.4.1"
